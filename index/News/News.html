<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>News</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
    <meta name="newsapi-key" content="">
</head>
<body>
    <nav class="navbar">
        <a href="/" class="nav-brand">The Blog.</a>
        <div class="nav-links">
            <a href="/index/Articles/Articles.html">Articles</a>
            <a href="/index/News/News.html">News</a>
            <a href="/index/Projects/Projects.html">Projects</a>
            <a href="/index/Finance/Finance.html">Finance</a>
            <a href="/index/Contacts/Contacts.html">Contact</a>
            <a href="/index/Projects/Numbers.html">Numbers</a>
        </div>
        <div class="menu-toggle">â˜°</div>
        <nav class="menu">
            <ul>
                <li><a href="/index/Articles/Articles.html">Articles</a></li>
                <li><a href="/index/News/News.html">News</a></li>
                <li><a href="/index/Projects/Projects.html">Projects</a></li>
                <li><a href="/index/Finance/Finance.html">Finance</a></li>
                <li><a href="/index/Contacts/Contacts.html">Contact</a></li>
                <li><a href="/index/Projects/Numbers.html">Numbers</a></li>
            </ul>
        </nav>
    </nav>
    <h1>Latest News</h1>
    <div class="category-buttons">
        <button onclick="updateCategory('general')">General</button>
        <button onclick="updateCategory('business')">Business</button>
        <button onclick="updateCategory('technology')">Technology</button>
        <button onclick="updateCategory('arts')">Arts</button>
        <button onclick="updateCategory('society')">Society</button>
    </div>

    <div id="gk-banner-top">
        <div class="gk-page">
            <div id="dynamic-news-slideshow" class="box widget_gk_news_slideshow">
                <!-- Slideshow content will be dynamically inserted here -->
            </div>
        </div>
    </div>

    <section id="gk-mainbody">
        <div id="latest-news-container">
            <!-- Latest news articles will be dynamically inserted here -->
        </div>
        <div id="pagination-container">
            <!-- Pagination controls will be dynamically inserted here -->
        </div>
    </section>

    <div id="news-container"></div>

    <script>
        const apiUrl = 'https://newsapi.org/v2/everything';
        const pageSize = 5; // Number of articles per page
        let currentPage = 1;
        let cache = {};

        function fetchNews(query = 'latest', page = 1) {
            const cacheKey = `query-${query}-page-${page}`;
            if (cache[cacheKey]) {
                updateContent(cache[cacheKey]);
                return;
            }

            // Show loading state
            showLoadingState();

            const apiKey = document.querySelector('meta[name="newsapi-key"]').getAttribute('content');

            fetch(`${apiUrl}?q=${query}&pageSize=${pageSize}&page=${page}&apiKey=${apiKey}`)
            .then(response => response.json())
            .then(data => {
                if (data.articles) {
                    cache[cacheKey] = data.articles;
                    updateContent(data.articles);
                }
            })
            .catch(error => {
                console.error('Error fetching news:', error);
                hideLoadingState();
            });
        }

        function updateContent(articles) {
            updateSlideshow(articles);
            updateLatestNews(articles);
            updatePagination();
            hideLoadingState();
        }

        function updateSlideshow(articles) {
            const container = document.getElementById('dynamic-news-slideshow');
            container.innerHTML = `
                <div class="gk-news-slideshow">
                    <div class="gk-ns-images">
                        ${articles.map(article => `
                            <div class="gk-ns-art">
                                ${article.urlToImage ? `
                                <a href="${article.url}" class="gk-ns-image-link">
                                    <img src="${article.urlToImage}" alt="${article.title}" class="gk-ns-image"/>
                                </a>` : ''}
                                <h3 class="gk-ns-header">
                                    <a href="${article.url}" title="${article.title}">${article.title}</a>
                                </h3>
                                <p class="gk-ns-text">${article.description || ''}</p>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function updateLatestNews(articles) {
            const container = document.getElementById('latest-news-container');
            container.innerHTML = `
                <div class="box">
                    <h3 class="box-title">Latest News from NewsAPI</h3>
                    ${articles.map(article => `
                        <div class="news-article">
                            <h4><a href="${article.url}" target="_blank">${article.title}</a></h4>
                            <p>${article.description || ''}</p>
                            <small>Source: ${article.source.name}</small>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function updatePagination() {
            const container = document.getElementById('pagination-container');
            container.innerHTML = `
                <button onclick="changePage(-1)" ${currentPage === 1 ? 'disabled' : ''}>Previous</button>
                <button onclick="changePage(1)">Next</button>
            `;
        }

        function changePage(direction) {
            currentPage += direction;
            fetchNews(currentQuery, currentPage);
        }

        function showLoadingState() {
            document.getElementById('dynamic-news-slideshow').innerHTML = '<p>Loading...</p>';
            document.getElementById('latest-news-container').innerHTML = '<p>Loading...</p>';
        }

        function hideLoadingState() {
            // Loading state will be hidden automatically when content is updated
        }

        function updateCategory(category) {
            currentQuery = category;
            fetchNews(currentQuery, 1);
        }

        let currentQuery = 'latest';
        // Fetch news when page loads
        document.addEventListener('DOMContentLoaded', () => fetchNews(currentQuery, currentPage));
    </script>

    <script src="scripts.js"></script>
</body>
</html>